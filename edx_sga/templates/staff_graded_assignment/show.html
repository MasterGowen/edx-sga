{% load i18n %}

<div class="sga-block" data-state="{{ student_state }}" 
     data-staff="{{ is_course_staff }}">
  <script type="text/template" id="sga-tmpl">
    <% if (uploaded) { %>
      <p><b>Загруженный файл: </b>
        <a href="<%= downloadUrl %>"><%= uploaded.filename %></a></p>
    <% } else { %>
      <p>Файл не был загружен.</p>
    <% } %>
    <% if (graded) { %>
      <p>Ваша оценка:<span style="padding: 6px; background-color: rgb(229, 0, 121);font-weight: bold;margin-left: 1em;"> <%= graded.score %> / <%= max_score %></span><br/>
        <% if (graded.comment) { %>
          <b>Комментарий преподавателя: </b> <%= graded.comment %>
        <% } %>
        <% if (annotated) { %><br/>
          <b>Файл, отправленный преподавателем: </b>
          <a href="<%= annotatedUrl %>"><%= annotated.filename %></a>
        <% } %>
      </p>
    <% } else if (uploaded) { %>
      <p>Оценка ещё не получена.</p>
    <% } %>
    <% if (upload_allowed) { %>
    <p>
      <% if (uploaded) { %>
        Загрузить другой файл
      <% } else { %>
        Загрузить файл
      <% } %>
      <div class="upload">
        <input class="fileupload" type="file" name="assignment"/>
        <button>Выбрать файл</button>
      </div>
    </p>
    <% } %>
    <% if (error) { %>
      <p class="error"><%= error %></p>
    <% } %>
  </script>

  <div id="sga-content">
  </div>

  {% if is_course_staff %}
  <script type="text/template" id="sga-grading-tmpl">
    <table class="gridtable">
      <tr>
        <th>Имя пользователя</th>
        <th>Полное имя</th>
        <th>Название файла</th>
        <th>Загружен</th>
        <th>Оценка</th>
        <th>Ответ преподавателя</th>
      </tr>
      <% for (var i = 0; i < assignments.length; i++) { %>
      <%     var assignment = assignments[i]; %>
        <tr id="row-<%= assignment.module_id %>">
          <td><%= assignment.username %></td>
          <td><%= assignment.fullname %></td>
          <td>
            <% if (assignment.filename) { %>
              <a href="<%= downloadUrl %>?module_id=<%= assignment.module_id %>">
                <%= assignment.filename %>
              </a>
            <% } %>
          </td>
          <td><%= assignment.timestamp %></td>
          <td>
            <%= assignment.score %> /
            <%= max_score %>
          </td>
          <td>
            <% if (assignment.annotated) { %>
              <a href="<%= annotatedUrl %>?module_id=<%= assignment.module_id %>">
                <%= assignment.annotated %>
              </a>
            <% } %>
          </td>
          <td>
            <a class="enter-grade-button" href="#{{ id }}-enter-grade">
              Поставить оценку
            </a>
          </td>
          <td>
            <div class="upload">
              <input class="fileupload" type="file" name="annotated"/>
              <button>Загрузить ответ</button>
            </div>
          </td>
        </tr>
      <% } %>
    </table>
  </script>

  <div aria-hidden="true" class="wrap-instructor-info">
    <a class="instructor-info-action" id="grade-submissions-button"
       href="#{{ id }}-grade">Журнал оценок</a>
  </div>

  <section aria-hidden="true" class="modal staff-modal" id="{{ id }}-grade">
    <div class="inner-wrapper" style="color: black">
      <header><h2>Загрузка файла</h2></header>
      <br/>
      <div id="grade-info" style="display: block;">
        Загрузка...
      </div>
    </div>
  </section>

  <section aria-hidden="true" class="modal grade-modal" id="{{ id }}-enter-grade" style="display: none; background-color: #ABB8C2; padding: 20px;">
    <div class="inner-wrapper" style="color: black">
      <header><h2 style="margin: 0;">Поставить оценку</h2></header>
      <br/>
      <div style="display: block;">
        <form id="enter-grade-form">
          <input id="module_id-input" type="hidden" name="module_id"/>
          <div>Слушатель: <span id="student-name" style="font-weight: bold; padding-left: 1em;"/></div>
          <div>Баллы (из 100): <div style="padding-left: 1em;"><input id="grade-input" style="font-weight: bold;" name="grade"/></div>
            <span class="error"></span></div>
          <div>Комментарий (видимый слушателю):<br /> <textarea id="comment-input" name="comment" rows="4"></textarea></div>
          <div>
            <button type="submit">Отправить</button>
            <button type="button" id="enter-grade-cancel">
              Отменить
            </button>
            <button type="button" id="remove-grade">
              Удалить оценку
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>
  {% endif %}
</div>
